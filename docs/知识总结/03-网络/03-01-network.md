# 网络基础

[[toc]]

## 网络结构模型

### 四、五、七层结构对比

<table>
  <tr>
    <td> <strong>OSI 七层模型</strong> </td>
    <td> <strong>TCP/IP 四层模型</strong> </td>
    <td> <strong>五层模型</strong> </td>
    <td> <strong>对应网络协议</strong> </td>
  </tr>
  <tr>
    <td>应用层（Application）</td>
    <td rowspan="3">应用层</td>
    <td rowspan="3">应用层</td>
    <td>HTTP、FTP、NFS、WAIT、SMTP</td>
  </tr>
  <tr>
    <td>表示层（Presentation）</td>
    <td>Telnet、Rlogin、SNMP、Gopher</td>
  </tr>
  <tr>
    <td>会话层（Session）</td>
    <td>DNS、SMTP</td>
  </tr>
  <tr>
    <td>传输层（Transport）</td>
    <td>传输层</td>
    <td>传输层</td>
    <td>TCP、UDP</td>
  </tr>
  <tr>
    <td>网络层（Network）</td>
    <td>网络层</td>
    <td>网络层</td>
    <td>IP、ICMP、RARP、AKP、UUCP</td>
  </tr>
  <tr>
    <td>数据链路层（Data Link）</td>
    <td rowspan="2">数据链路层</td>
    <td>数据链路层</td>
    <td>FDDI、Ethernet、Arpanet、PDN、SLIP、PPP</td>
  </tr>
  <tr>
    <td>物理层（Physical）</td>
    <td>物理层</td>
    <td>IEEE 802.1A、IEEE 802.2 到 IEEE 802.11</td>
  </tr>
</table>

### 模型分层介绍

- **物理层 (physical Layer)**：**确保数据可以在各种物理媒介上进行传输**，为数据的传输提供可靠的环境（负责怎么把电脑连接起来，形成一个网络）。
- **数据链路层 (data link layer)**：主要将物理层接受的数据**进行 MAC 地址（网卡地址）的封装与解除封装**。负责将网络层交下来的 IP 数据报封装成帧，并在链路的两个相邻节点间传送帧，每一帧都包含数据和必要的控制信息（如同步信息、地址信息、差错控制等）。在这一层工作的设备叫做交换机，数据通过交换机来传输。
- **网络层 (internet layer)**：主要从下层接受到的数据**进行 IP 地址的封装与解封装**。在这一层工作的设备是路由器。把这一次的数据叫做数据包。
- **传输层 (transport layer)**：它负责**为两台主机中的进程提供通信服务**，定义了一些传输数据的协议和端口号。该层主要有以下两种协议：
  - **传输控制协议**(Transmission Control Protocol，TCP)：提供面向连接的、可靠的数据传输服务，数据传输的基本单位是报文段（segment）；
  - **用户数据报协议**(User Datagram Protocol，UDP)：提供无连接的、尽最大努力的数据传输服务，但不保证数据传输的可靠性，数据传输的基本单位是用户数据报。
- **会话层**：通过传输层（端口号：传输端口与接受端口）建立数据传送的通路。主要在你的系统之间发起会话或者接收会话请求（设备之间需要互相认识可以是 IP 也可以是 MAC 地址或者主机名）
- **表示层**：主要是对接收的数据进行解释 加密与解密压缩与解压缩等（也就是把计算机能够识别的东西转换成人能识别的东西，图片声音等）
- **应用层 (application layer)**：**直接为应用进程提供服务**。应用层协议定义的是应用进程间通讯和交互的规则，不同的应用有着不同的应用层协议，如 HTTP 协议（万维网服务）、FTP 协议（文件传输）、SMTP 协议（电子邮件）、DNS（域名查询）等。

## DNS

> DNS 是基于 UDP 做的查询。

DNS 的作用就是通过域名查询到具体的 IP。**DNS (Domain Name System)** 是互联网中的重要基础设施，负责对域名的解析工作，为了保证高可用、高并发和分布式，它设计成了树状的层次结构。

由根 DNS 服务器、顶级域 DNS 服务器和权威 DNS 服务器组成。

因为 IP 存在数字和英文的组合（IPv6），很不利于人类记忆，所以就出现了域名。你可以把域名看成是某个 IP 的别名，DNS 就是去查询这个别名的真正名称是什么。

在 TCP 握手之前就已经进行了 DNS 查询，这个查询是操作系统自己做的。当你在浏览器中想访问 `www.google.com` 时，会进行一下操作：

1. 操作系统会首先**在浏览器本地缓存**中查询，没有再去**操作系统的缓存**查询
2. 再没有的话去**路由器的缓存**查询，没有再去**ISP DNS 缓存**（互联网提供商）查找
3. 如果这时候还没得话，会直接去 **DNS 根服务器**查询，这一步查询会找出负责 `com` 这**个一级域名**的服务器
4. 然后去该服务器查询 `google` 这**个二级域名**
5. 接下来**三级域名**的查询其实是我们配置的，你可以给 `www` 这个域名配置一个 IP，然后还可以给别的三级域名配置一个 IP

以上介绍的是 DNS 迭代查询，还有种是递归查询，区别就是前者是由客户端去做请求，后者是由系统配置的 DNS 服务器做请求，得到结果后将数据返回给客户端。

## IP

## CDN

CDN（Content Delivery Network）就是**内容分发网络**。

为了突破现实生活中的光速、传输距离等物理限制，CDN 投入了大量资金，在全球范围内各大枢纽城市建立机房，部署大量高存储高带宽的节点，构建跨运营商、跨地域的专用高速传输网络。

其中分为中心节点、区域节点、边缘节点等，在用户接入网络后，首先通过**全局负载均衡 (Global Sever Load Balance)**，简称 GSLB 算法负责调度，找到离用户最合适的节点。然后通过 HTTP 缓存代理技术进行缓存，缓存命中就返回给用户，否则就回源站去取。CDN 擅长缓存静态资源(图片、音频等)，当然也支持动态内容的缓存。

## WebSocket

**WebSocket** 是一种**基于 TCP 的轻量级网络通信协议**。和 HTTP/2 一样，都是为了解决 HTTP 某些方面的缺陷而诞生的。不过解决方式略有不同，**HTTP/2 针对的是“队头阻塞 ”，WebSocket 针对的是“请求-应答”的通信模式**。

我们知道“请求-应答”是半双工的通信模式，不具备服务器推送能力。这就限制了 HTTP 在实时通信领域的发展。虽然可以使用轮询来不停的向服务器发送 HTTP 请求，但是缺点也很大，反复的无效请求占用了大量的带宽和 CPU 资源。所以，WebSocket 应运而生。

WebSocket 是一个全双工通信协议，具备服务端主动推送的能力。本质上是对 TCP 做了一层包装，让它可以运行在浏览器环境里。
